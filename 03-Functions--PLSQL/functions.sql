
CREATE OR REPLACE FUNCTION FUN_DB_CALCULA_VL_TOT_VENDA( P_ANO_VENDA IN NUMBER) RETURN NUMBER
IS
-- VARIÁVEL DO TIPO DE DADO DA COLUNA, POIS VAMOS
-- REALIZAR CÁLCULO SOBRE ELA.
V_VL_TOT_VENDA DB_PEDIDO.VL_TOT_PEDIDO%TYPE;
BEGIN
    SELECT  SUM(VL_TOT_PEDIDO) VAL_TOT_VENDA
    INTO    V_VL_TOT_VENDA
    FROM    DB_PEDIDO
    WHERE   EXTRACT( YEAR FROM DT_PEDIDO) = P_ANO_VENDA;
    
    IF V_VL_TOT_VENDA IS NULL THEN
        V_VL_TOT_VENDA := 00;
    END IF;
    
    -- RETORNANDO A VARIÁVEL COM O CÁLCULO REALIZADO
    RETURN V_VL_TOT_VENDA;
EXCEPTION
	WHEN OTHERS THEN
		RAISE_APPLICATION_ERROR (-20010, 'ERRO CRÍTICO NA FUNÇÃO FUN_DB_CALCULA_VL_TOT_VENDA ' || SQLERRM);
		
END FUN_DB_CALCULA_VL_TOT_VENDA;
/


--===================================================================================================================


--
-- Script criado para acionar a função FUN_DB_CALCULA_VL_TOT_VENDA
--
SET SERVEROUTPUT ON;
DECLARE
	V_ANO NUMBER(4) := EXTRACT( YEAR FROM SYSDATE);
	V_VL_TOT_VENDA_BRUTO NUMBER;
BEGIN
	V_VL_TOT_VENDA_BRUTO := FUN_DB_CALCULA_VL_TOT_VENDA (V_ANO);
	DBMS_OUTPUT.PUT_LINE('O ANO DE (' || V_ANO || ') TEVE O VALOR TOTAL DE VENDA BRUTO EM:' || V_VL_TOT_VENDA_BRUTO );
END;


--===================================================================================================================